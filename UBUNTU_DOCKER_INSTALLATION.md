# üöÄ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ Ubuntu 24.04 —Å Docker

## –î–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –≤ —Å–µ—Ä–≤–µ—Ä–∞—Ö

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–æ–≤–µ–¥–µ—Ç –≤–∞—Å —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —á–µ—Ä–µ–∑ –ø–æ–ª–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É Telegram-–±–æ—Ç–∞ –Ω–∞ —Å–≤–µ–∂–∏–π —Å–µ—Ä–≤–µ—Ä Ubuntu 24.04.

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** 20-30 –º–∏–Ω—É—Ç  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –õ–µ–≥–∫–æ (–ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã)  
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –¢–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É Ubuntu 24.04

---

## üìã –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π Telegram-–±–æ—Ç  
‚úÖ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ Redis –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
‚úÖ Nginx reverse proxy  
‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (HTTPS)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö  
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ DDoS  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã  

---

## üéØ –®–ê–ì 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ:

1. **–°–µ—Ä–≤–µ—Ä Ubuntu 24.04**
   - –ú–æ–∂–Ω–æ –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –Ω–∞: Hetzner, DigitalOcean, VPS.ru, Timeweb
   - –ú–∏–Ω–∏–º—É–º: 2 GB RAM, 20 GB –¥–∏—Å–∫
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 4 GB RAM, 40 GB –¥–∏—Å–∫

2. **–î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä: bot.yourdomain.com)
   - –ö—É–ø–∏—Ç—å –º–æ–∂–Ω–æ –Ω–∞: Namecheap, GoDaddy, reg.ru
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å A-–∑–∞–ø–∏—Å—å –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

3. **–î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:**
   - IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
   - –ü–∞—Ä–æ–ª—å root –∏–ª–∏ –∫–ª—é—á SSH

### –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:

**Windows:**
```bash
# –°–∫–∞—á–∞–π—Ç–µ PuTTY: https://www.putty.org/
# –í–≤–µ–¥–∏—Ç–µ IP, –ø–æ—Ä—Ç 22, –Ω–∞–∂–º–∏—Ç–µ Open
# –õ–æ–≥–∏–Ω: root
# –ü–∞—Ä–æ–ª—å: –≤–∞—à –ø–∞—Ä–æ–ª—å
```

**Mac/Linux:**
```bash
ssh root@YOUR_SERVER_IP
# –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∫–æ–≥–¥–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç
```

---

## üîß –®–ê–ì 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –æ–¥–Ω—É –∑–∞ –¥—Ä—É–≥–æ–π:

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø–∞–∫–µ—Ç—ã
sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã
sudo apt install -y curl wget git nano ufw
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

---

## üì¶ –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

### 2.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Engine

```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
sudo apt remove -y docker docker-engine docker.io containerd runc

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sudo apt install -y ca-certificates curl gnupg lsb-release

# –î–æ–±–∞–≤–∏—Ç—å GPG –∫–ª—é—á Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Docker
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
docker --version
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `Docker version 24.0.0 ...`

### 2.2 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã
sudo systemctl enable docker
sudo systemctl start docker

# –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker (—á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å sudo)
sudo usermod -aG docker $USER

# –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –≤—ã–π–¥–∏—Ç–µ –∏ –∑–∞–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞, –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
newgrp docker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ docker —Ä–∞–±–æ—Ç–∞–µ—Ç
docker ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

---

## üìÇ –®–ê–ì 3: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –±–æ—Ç–∞

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ~

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!)
git clone https://github.com/YOUR_USERNAME/remnawave-tg-shop-main.git

# –í–æ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd remnawave-tg-shop-main

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–∞—á–∞–ª–∏—Å—å
ls -la
```

**–ß—Ç–æ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
```
docker-compose.production.yml
Dockerfile
.env.example
main.py
bot/
db/
...
```

---

## üîê –®–ê–ì 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

### 4.1 –°–æ–∑–¥–∞—Ç—å .env –∏–∑ —à–∞–±–ª–æ–Ω–∞

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
cp .env.example .env

# –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
nano .env
```

### 4.2 –ó–∞–ø–æ–ª–Ω–∏—Ç—å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –Ω–∞–π–¥–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:

```env
# ======== –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ó–ú–ï–ù–ò–¢–¨ ========

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–≤–∞—à Telegram ID, –ø–æ–ª—É—á–∏—Ç–µ —É @userinfobot)
ADMIN_IDS=123456789

# –î–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ë–ï–ó https://)
WEBHOOK_BASE_URL=https://bot.yourdomain.com

# –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É
SUPPORT_LINK=https://t.me/your_support

# ======== –ë–ê–ó–ê –î–ê–ù–ù–´–• (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è Docker) ========
POSTGRES_USER=postgres
POSTGRES_PASSWORD=–ò–ó–ú–ï–ù–ò–¢–ï_–ù–ê_–°–õ–û–ñ–ù–´–ô_–ü–ê–†–û–õ–¨
POSTGRES_HOST=remnawave-tg-shop-db
POSTGRES_PORT=5432
POSTGRES_DB=postgres

# ======== REDIS (–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è Docker) ========
REDIS_ENABLED=True
REDIS_HOST=remnawave-redis
REDIS_PORT=6379
REDIS_FSM_DB=0
REDIS_CACHE_DB=1

# ======== RATE LIMITING (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞) ========
RATE_LIMIT_ENABLED=True
RATE_LIMIT_MAX_REQUESTS=20
RATE_LIMIT_TIME_WINDOW=60

# ======== –ü–õ–ê–¢–ï–ñ–ù–´–ï –°–ò–°–¢–ï–ú–´ ========
# YooKassa (–ø–æ–ª—É—á–∏—Ç–µ –Ω–∞ yookassa.ru)
YOOKASSA_SHOP_ID=your_shop_id_here
YOOKASSA_SECRET_KEY=your_secret_key_here

# API –ø–∞–Ω–µ–ª–∏ Remnawave
PANEL_API_URL=http://your_panel_url/api
PANEL_API_KEY=your_panel_api_key_here
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ nano:**
- –ù–∞–∂–º–∏—Ç–µ `Ctrl + X`
- –ù–∞–∂–º–∏—Ç–µ `Y` (Yes)
- –ù–∞–∂–º–∏—Ç–µ `Enter`

### 4.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ .env —Å–æ–∑–¥–∞–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la .env

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –Ω–∏–∫–æ–º—É!)
cat .env | grep BOT_TOKEN
```

---

## üîí –®–ê–ì 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall (UFW)

```bash
# –í–∫–ª—é—á–∏—Ç—å firewall
sudo ufw enable

# –†–∞–∑—Ä–µ—à–∏—Ç—å SSH (–í–ê–ñ–ù–û! –ò–Ω–∞—á–µ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–æ—Å—Ç—É–ø)
sudo ufw allow 22/tcp

# –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP –∏ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo ufw status
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Status: active

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW       Anywhere
80/tcp                     ALLOW       Anywhere
443/tcp                    ALLOW       Anywhere
```

---

## üåê –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (Let's Encrypt)

### 6.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
nano nginx/conf.d/bot.conf
```

**–ó–ê–ú–ï–ù–ò–¢–ï** `yourdomain.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –≤ **3 –º–µ—Å—Ç–∞—Ö:**
1. –°—Ç—Ä–æ–∫–∞ 7: `server_name yourdomain.com www.yourdomain.com;`
2. –°—Ç—Ä–æ–∫–∞ 22: `server_name yourdomain.com www.yourdomain.com;`  
3. –°—Ç—Ä–æ–∫–∏ 25-27: –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º

–ü—Ä–∏–º–µ—Ä:
```nginx
server_name bot.example.com;

ssl_certificate /etc/letsencrypt/live/bot.example.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/bot.example.com/privkey.pem;
ssl_trusted_certificate /etc/letsencrypt/live/bot.example.com/chain.pem;
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: `Ctrl + X`, `Y`, `Enter`

### 6.2 –ó–∞–ø—É—Å—Ç–∏—Ç—å Nginx –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è certbot
mkdir -p nginx/certbot/conf
mkdir -p nginx/certbot/www

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–û–õ–¨–ö–û nginx –∏ certbot
docker compose -f docker-compose.production.yml up -d nginx certbot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ nginx –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker ps | grep nginx
```

### 6.3 –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –ó–ê–ú–ï–ù–ò–¢–ï bot.yourdomain.com –∏ your@email.com –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ!
docker compose -f docker-compose.production.yml run --rm certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  --email your@email.com \
  --agree-tos \
  --no-eff-email \
  -d bot.yourdomain.com
```

**–ß—Ç–æ —Å–ø—Ä–æ—Å—è—Ç:**
- `Enter email address` ‚Üí –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à email
- `Terms of Service` ‚Üí –Ω–∞–∂–º–∏—Ç–µ `A` (Agree)
- `Share email` ‚Üí –Ω–∞–∂–º–∏—Ç–µ `N` (No)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/bot.yourdomain.com/fullchain.pem
```

### 6.4 –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx —Å SSL

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.production.yml down

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω
ls -la nginx/certbot/conf/live/
```

---

## üöÄ –®–ê–ì 7: –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –°–æ–∑–¥–∞—Ç—å network (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞)
docker network create remnawave-network 2>/dev/null || true

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –í–°–ï —Å–µ—Ä–≤–∏—Å—ã (–ë–î, Redis, Bot, Nginx)
docker compose -f docker-compose.production.yml up -d

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
sleep 30

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker ps
```

**–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å 5 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**
```
CONTAINER ID   IMAGE             STATUS         PORTS                   NAMES
xxxxx          nginx:alpine      Up 10 seconds  0.0.0.0:80->80/tcp...  remnawave-nginx
xxxxx          custom-bot        Up 20 seconds                         remnawave-bot
xxxxx          redis:7-alpine    Up 25 seconds                         remnawave-redis
xxxxx          postgres:17       Up 30 seconds                         remnawave-db
xxxxx          certbot/certbot   Up 10 seconds                         remnawave-certbot
```

---

## üè• –®–ê–ì 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 8.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)
docker logs -f remnawave-bot
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
```
‚úÖ "FSM Storage: Using RedisStorage"
‚úÖ "RedisStorage: Connected to Redis"
‚úÖ "Rate limiting middleware registered"
‚úÖ "bot.set_webhook ... returned SUCCESS"
‚úÖ "Starting bot in Webhook mode"
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏** - —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Troubleshooting" –≤–Ω–∏–∑—É

### 8.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ HTTPS
curl https://bot.yourdomain.com/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** `{"status":"ok"}`

### 8.3 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –ø–æ username
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
4. –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

**–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç** - —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Troubleshooting"

---

## üîÑ –®–ê–ì 9: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞
docker exec -it remnawave-bot bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –í—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
exit

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker restart remnawave-bot
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –®–ê–ì 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 10.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "Up" –∏ "healthy"
docker ps --format "table {{.Names}}\t{{.Status}}"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
NAMES                STATUS
remnawave-nginx      Up (healthy)
remnawave-bot        Up (healthy)
remnawave-redis      Up (healthy)
remnawave-db         Up (healthy)
remnawave-certbot    Up
```

### 10.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis

```bash
docker exec -it remnawave-redis redis-cli ping
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `PONG`

### 10.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PostgreSQL

```bash
docker exec -it remnawave-db psql -U postgres -d postgres -c "SELECT version();"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –í–µ—Ä—Å–∏—è PostgreSQL 17

### 10.4 –¢–µ—Å—Ç –±–æ—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥:
- `/start` - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `/help` - –ø–æ–º–æ—â—å (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

**–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! üéâ**

---

## üéõÔ∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
docker logs -f remnawave-bot

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose -f docker-compose.production.yml logs -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ –±–æ—Ç–∞
docker logs --tail 100 remnawave-bot

# –õ–æ–≥–∏ Nginx
docker logs -f remnawave-nginx
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker compose -f docker-compose.production.yml down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ
docker compose -f docker-compose.production.yml up -d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–æ—Ç–∞
docker restart remnawave-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ
docker compose -f docker-compose.production.yml restart

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker ps -a
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
docker compose -f docker-compose.production.yml down

# 2. –°–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ git
git pull

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker compose -f docker-compose.production.yml build --no-cache

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
docker compose -f docker-compose.production.yml up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs -f remnawave-bot
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec remnawave-db pg_dump -U postgres postgres > backup_$(date +%Y%m%d).sql

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø .env (–í–ê–ñ–ù–û: –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ!)
cp .env .env.backup_$(date +%Y%m%d)

# –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø –Ω–∞ –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ –°–í–û–ï–ú –∫–æ–º–ø—å—é—Ç–µ—Ä–µ)
scp root@YOUR_SERVER_IP:~/remnawave-tg-shop-main/backup_*.sql ./
```

### Restore –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±—ç–∫–∞–ø–∞
cat backup_20241124.sql | docker exec -i remnawave-db psql -U postgres postgres
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
df -h

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ Nginx
docker exec remnawave-nginx cat /var/log/nginx/error.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ PostgreSQL
docker exec remnawave-db pg_stat_activity
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö health checks:

```bash
# –û—Ç–∫—Ä—ã—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å (–ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à email):
0 9 * * * docker ps | grep -q remnawave-bot || echo "Bot is down!" | mail -s "Alert: Bot Down" your@email.com
```

---

## ‚ö†Ô∏è Troubleshooting - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Cannot start service bot: bind: address already in use"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8080
sudo lsof -i :8080

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–ó–ê–ú–ï–ù–ò–¢–ï PID)
sudo kill -9 PID

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –≤ docker-compose.production.yml
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Connection refused" –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞
docker ps | grep remnawave-db

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ - –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker start remnawave-db

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥
sleep 10

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker restart remnawave-bot
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
nslookup bot.yourdomain.com

# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

# –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å SSL –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP
# –í docker-compose.production.yml –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ü–∏—é certbot
# –í nginx/conf.d/bot.conf –≤—Ä–µ–º–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç–µ HTTPS server block
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# 1. –õ–æ–≥–∏ –±–æ—Ç–∞
docker logs --tail 50 remnawave-bot | grep ERROR

# 2. Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo

# 3. .env —Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
cat .env | grep WEBHOOK_BASE_URL
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: WEBHOOK_BASE_URL=https://bot.yourdomain.com (–ë–ï–ó —Å–ª—ç—à–∞ –≤ –∫–æ–Ω—Ü–µ)

# 4. Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
docker logs remnawave-nginx | grep webhook
```

### –ü—Ä–æ–±–ª–µ–º–∞ 6: "Out of memory"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –ï—Å–ª–∏ RAM < 2GB, —É–≤–µ–ª–∏—á—å—Ç–µ swap:
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å –æ—à–∏–±–∫–∞–º–∏
docker logs remnawave-bot --tail 100

# –ß–∞—Å—Ç–æ —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º—ã —Å .env - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ REQUIRED –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
nano .env
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑)

Certbot –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ docker-compose.production.yml).

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ —Ç–∞–∫:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (dry-run)
docker compose -f docker-compose.production.yml run --rm certbot renew --dry-run
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `The dry run was successful.`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cat > monitor.sh << 'EOF'
#!/bin/bash
echo "=== Docker Containers ==="
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Size}}"

echo -e "\n=== Memory Usage ==="
free -h

echo -e "\n=== Disk Usage ==="
df -h /

echo -e "\n=== Bot Logs (last 10 lines) ==="
docker logs --tail 10 remnawave-bot
EOF

# –°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x monitor.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./monitor.sh
```

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å (–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00):
0 9 * * * /root/remnawave-tg-shop-main/monitor.sh >> /var/log/bot_monitor.log 2>&1
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–í–ê–ñ–ù–û!)

### 1. –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å root
passwd

# –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å PostgreSQL –≤ .env
nano .env
# –ù–∞–π—Ç–∏ POSTGRES_PASSWORD –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH –∫–ª—é—á–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ù–∞ –í–ê–®–ï–ú –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
ssh-keygen -t ed25519

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id root@YOUR_SERVER_IP

# –û—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—Ä–æ–ª—å SSH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
sudo nano /etc/ssh/sshd_config
# –ù–∞–π—Ç–∏: PasswordAuthentication yes
# –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: PasswordAuthentication no
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å SSH:
sudo systemctl restart sshd
```

### 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab (–∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00)
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
0 3 * * 0 apt update && apt upgrade -y && docker system prune -f
```

---

## üÜò –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

### –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∏ restart

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker compose -f docker-compose.production.yml down

# 2. –£–¥–∞–ª–∏—Ç—å volumes (–í–ù–ò–ú–ê–ù–ò–ï: –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
docker volume rm remnawave-postgres-data remnawave-redis-data

# 3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å network
docker network rm remnawave-network
docker network create remnawave-network

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
docker compose -f docker-compose.production.yml up -d

# 5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ
docker exec -it remnawave-bot alembic upgrade head
```

### –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–º–∏—Ç—ã
git log --oneline

# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (–ó–ê–ú–ï–ù–ò–¢–ï hash)
git checkout abc123

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker-compose.production.yml up -d --build
```

### –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏: `docker logs remnawave-bot > bot_logs.txt`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env (–ó–ê–ú–ê–°–ö–ò–†–£–ô–¢–ï –ø–∞—Ä–æ–ª–∏!): `cat .env | sed 's/PASSWORD=.*/PASSWORD=***/' > env_safe.txt`
3. –°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub —Å —ç—Ç–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏

---

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

### YooKassa

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://yookassa.ru
2. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω
3. –ü–æ–ª—É—á–∏—Ç–µ `shopId` –∏ `secretKey`
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   YOOKASSA_SHOP_ID=–≤–∞—à_shop_id
   YOOKASSA_SECRET_KEY=–≤–∞—à_secret_key
   ```
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker restart remnawave-bot`

### CryptoPay (Crypto Bot)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @CryptoBot –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ API token
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   CRYPTOPAY_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
   CRYPTOPAY_ENABLED=True
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å —Å–µ—Ä–≤–µ—Ä —Å –±–æ–ª—å—à–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏:

```bash
nano docker-compose.production.yml

# –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é deploy.resources.limits –∏ —É–≤–µ–ª–∏—á—å—Ç–µ:
limits:
  cpus: '2.0'      # –±—ã–ª–æ 1.5
  memory: 2G       # –±—ã–ª–æ 1G
```

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
cat > backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/root/backups"
mkdir -p $BACKUP_DIR

# –ë—ç–∫–∞–ø PostgreSQL
docker exec remnawave-db pg_dump -U postgres postgres | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# –ë—ç–∫–∞–ø Redis
docker exec remnawave-redis redis-cli save
docker cp remnawave-redis:/data/dump.rdb $BACKUP_DIR/redis_$DATE.rdb

# –ë—ç–∫–∞–ø .env
cp .env $BACKUP_DIR/env_$DATE.backup

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (> 7 –¥–Ω–µ–π)
find $BACKUP_DIR -type f -mtime +7 -delete

echo "Backup completed: $DATE"
EOF

chmod +x backup.sh

# –î–æ–±–∞–≤–∏—Ç—å –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
0 3 * * * /root/remnawave-tg-shop-main/backup.sh >> /var/log/backup.log 2>&1
```

---

## üåü –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Grafana (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```yaml
# –î–æ–±–∞–≤–∏—Ç—å –≤ docker-compose.production.yml:
  grafana:
    image: grafana/grafana:latest
    container_name: remnawave-grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - remnawave-network
    restart: unless-stopped

volumes:
  grafana_data:
```

–î–æ—Å—Ç—É–ø: `http://YOUR_SERVER_IP:3000` (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: admin)

### 2. Logrotate –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞

```bash
sudo nano /etc/logrotate.d/docker

# –î–æ–±–∞–≤–∏—Ç—å:
/var/lib/docker/containers/*/*.log {
  rotate 7
  daily
  compress
  size=10M
  missingok
  delaycompress
  copytruncate
}
```

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://docs.docker.com/
- **Let's Encrypt:** https://letsencrypt.org/
- **Nginx –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://nginx.org/ru/docs/
- **PostgreSQL:** https://www.postgresql.org/docs/
- **Redis:** https://redis.io/documentation

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

–û—Ç–º–µ—Ç—å—Ç–µ –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç:

- [ ] –°–µ—Ä–≤–µ—Ä Ubuntu 24.04 –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –î–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞ (A-–∑–∞–ø–∏—Å—å)
- [ ] Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] .env —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω (BOT_TOKEN, ADMIN_IDS, WEBHOOK_BASE_URL, etc.)
- [ ] Firewall (UFW) –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–ø–æ—Ä—Ç—ã 22, 80, 443)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω –æ—Ç Let's Encrypt
- [ ] –í—Å–µ 4-5 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω—ã (docker ps)
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ (alembic upgrade head)
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram –Ω–∞ /start
- [ ] Webhook –∞–∫—Ç–∏–≤–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ getWebhookInfo)
- [ ] –õ–æ–≥–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (cron)

**–ï—Å–ª–∏ –≤—Å–µ –æ—Ç–º–µ—á–µ–Ω–æ - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! üéâ**

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

1. **Linux –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö:** https://www.youtube.com/watch?v=... (–ª—é–±–æ–π tutorial)
2. **Docker basics:** https://www.docker.com/101-tutorial
3. **Nginx basics:** https://www.nginx.com/resources/wiki/start/
4. **SSH –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** https://www.digitalocean.com/community/tutorials/

---

## üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º** - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Ç–∞–º
2. **–ü–µ—Ä–µ—á–∏—Ç–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é** - –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏

 —à–∞–≥
3. **–ü–æ–∏—â–∏—Ç–µ –æ—à–∏–±–∫—É –≤ Google/ChatGPT** - —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
4. **–°–æ–∑–¥–∞–π—Ç–µ Issue –Ω–∞ GitHub** - —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏

---

**üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à –±–æ—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production!** üéâ

**–î–∞—Ç–∞:** 2024-11-24  
**–í–µ—Ä—Å–∏—è:** 1.0 Production Ready  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê (–õ–µ–≥–∫–æ –ø—Ä–∏ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º)